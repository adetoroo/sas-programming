*****************************************
Filename: Vital_Signs.sas
Author: Moses Adetoro
Date: 25 April 2019
SAS: SAS 9.4 (TS2M0)
Platform: Windows XP
Project/Study: 765/15
Description: <To develop the SDTM VS Datasets>
Input: Raw.Vital_Signs
Output: SDTM.VS
Macros Used: <No macros used>
------------------------------------------
MODIFICATION HISTORY:

<DD-MON-YYYY>, <Firstname Lastname>

<Description>
******************************************;
libname Raw "C:\PROJECT\QPS3\RAW";
libname SDTM "C:\PROJECT\QPS3\SDTM";

/*Derived Vital Signs SDTM datasets*/

DATA VS;
SET Raw.Vital_Signs2;
STUDYID="765/15";
Domain="VS";
SUBJID=strip(SUBJID);
SITEID="001";
USUBJID=STRIP(STUDYID)||"-"||STRIP(SITEID)||"-"||STRIP(SUBJID);
VSDTC=PUT(RECDT, IS8601DA.)||"T"||PUT(RECDTM, TOD8.);
VSDTN=DATEPART(INPUT(VSDTC, IS8601DT.));
FORMAT VSDTN DATE10.;

RUN;

DATA VS1;
SET VS;
VSTPT=PROPCASE(TP);
IF VSTPT="Check-In" THEN VSTPTNUM=1;
ELSE IF VSTPT="0" THEN VSTPTNUM=2;
ELSE IF VSTPT="2" THEN VSTPTNUM=3;
ELSE IF VSTPT="8" THEN VSTPTNUM=4;
ELSE IF VSTPT="Check-Out" THEN VSTPTNUM=5;

IF VISIT="SCREENING" THEN DO;
VISITNUM=0;
VISIT=UPCASE(VISIT);
END;

IF VISIT="PERIOD-1" THEN DO;
VISITNUM=1;
VISIT=UPCASE(VISIT);
END;

IF VISIT="PERIOD-2" THEN DO;
VISITNUM=2;
VISIT=UPCASE(VISIT);
END;

RUN;

PROC SORT DATA=VS1 OUT=VS2;
BY STUDYID DOMAIN USUBJID VISITNUM VISIT VSTPTNUM VSTPT VSDTC;
RUN;

PROC TRANSPOSE DATA=VS2 OUT=VS3;
BY STUDYID DOMAIN USUBJID VISITNUM VISIT VSTPTNUM VSTPT VSDTC;
VAR PULSE TEMP SYS DIA;
RUN;

/* STEPS TO CREATE VSTEST VSTESTCD VARIABLES */

DATA VS4;
SET VS3;

LENGTH VSTEST $40. VSTESTCD $8.;
IF _NAME_ = "PULSE" THEN DO;
VSTEST="Pulse Rate";
VSTESTCD="PULSE";
END;

IF _NAME_ = "TEMP" THEN DO;
VSTEST="Temperature";
VSTESTCD="TEMP";
END;

IF _NAME_ = "SYS" THEN DO;
VSTEST="Systolic Blood Pressure";
VSTESTCD="SYSBP";
END;

IF _NAME_ = "DIA" THEN DO;
VSTEST="Diastolic Blood Pressure";
VSTESTCD="DIABP";
END;

VSORRES=STRIP(PUT(COL1,BEST.));
DROP COL1;

RUN;

/* STEPS TO DERIVE VSORRESU */;

PROC TRANSPOSE DATA=VS2 OUT=VS33;
BY STUDYID DOMAIN USUBJID VISITNUM VISIT VSTPTNUM VSTPT VSDTC;
VAR PULSEU TEMPU SYSU DIAU;
RUN;

DATA VS5;
SET VS33;

LENGTH VSTEST VSORRESU $40. VSTESTCD $8.;
IF _NAME_ = "PULSEU" THEN DO;
VSTEST="Pulse Rate";
VSTESTCD="PULSE";
END;

IF _NAME_ = "TEMPU" THEN DO;
VSTEST="Temperature";
VSTESTCD="TEMP";
END;

IF _NAME_ = "SYSU" THEN DO;
VSTEST="Systolic Blood Pressure";
VSTESTCD="SYSBP";
END;

IF _NAME_ = "DIAU" THEN DO;
VSTEST="Diastolic Blood Pressure";
VSTESTCD="DIABP";
END;

VSORRESU=STRIP(COL1);
IF VSORRESU="per min" THEN VSORRESU="beats/min";
ELSE IF VSORRESU="mm of Hg" THEN VSORRESU="mmHg";
ELSE IF VSORRESU="f" THEN VSORRESU="F";

DROP COL1;
VSSTRESU=VSORRESU;
RUN;

/*TO DERIVE VSSTRESC AND VSSTRESN */;

PROC TRANSPOSE DATA=VS2 OUT=VS333;
BY STUDYID DOMAIN USUBJID VISITNUM VISIT VSTPTNUM VSTPT VSDTC;
VAR PULSER TEMPR SYSR DIAR;
RUN;

DATA VS6;
SET VS333;
LENGTH VSTEST $40. VSSTRESC $200. VSTESTCD $8.;
IF _NAME_ = "PULSER" THEN DO;
VSTEST="Pulse Rate";
VSTESTCD="PULSE";
END;

IF _NAME_ = "TEMPR" THEN DO;
VSTEST="Temperature";
VSTESTCD="TEMP";
END;

IF _NAME_ = "SYSR" THEN DO;
VSTEST="Systolic Blood Pressure";
VSTESTCD="SYSBP";
END;

IF _NAME_ = "DIAR" THEN DO;
VSTEST="Diastolic Blood Pressure";
VSTESTCD="DIABP";
END;

VSSTRESC=STRIP(COL1);
VSSTRESN=INPUT(VSSTRESC, ?? BEST.);
DROP COL1;
RUN;

PROC SORT DATA=VS4;
BY STUDYID DOMAIN USUBJID VISITNUM VISIT VSTPTNUM VSTPT VSDTC VSTESTCD;
RUN;

PROC SORT DATA=VS5;
BY STUDYID DOMAIN USUBJID VISITNUM VISIT VSTPTNUM VSTPT VSDTC VSTESTCD;
RUN;

PROC SORT DATA=VS6;
BY STUDYID DOMAIN USUBJID VISITNUM VISIT VSTPTNUM VSTPT VSDTC VSTESTCD;
RUN;

DATA FINAL;
MERGE VS4 VS5 VS6;
BY STUDYID DOMAIN USUBJID VISITNUM VISIT VSTPTNUM VSTPT VSDTC VSTESTCD;
RUN;

DATA FINAL1;
SET FINAL;
IF VSTPT="0" THEN VSBLFL="Y";
VSDTN=DATEPART(INPUT(VSDTC, IS8601DT.));
FORMAT VSDTN DATE10.;
RUN;

/*BRNG-IN DM RAW DATASET TO EXTRACT HT WT BMI INFO*/;

DATA DM;
SET RAW.DEMO_RAW1;
STUDYID="765/15";
Domain="VS";
SUBJID=strip(SUBJID);
SITEID="001";
USUBJID=STRIP(STUDYID)||"-"||STRIP(SITEID)||"-"||STRIP(SUBJID);
X=INPUT(ENRDT, MMDDYY10.);
FORMAT X MMDDYY10.;
VSDTC=PUT(X, IS8601DA.)||"T"||PUT(ENRTM, TOD8.);
VSDTN=DATEPART(INPUT(VSDTC, IS8601DT.));
FORMAT VSDTN DATE10.;
DROP X;
RUN;




RUN;

